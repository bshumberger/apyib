import psi4
import numpy as np
import apyib
import pytest
from ..data.molecules import *

def test_rhf_analytic_hessian():
    # Set parameters for the calculation.
    parameters = {'geom': moldict["H2O_C4_HF"],
                  'basis': 'STO-3G',
                  'method': 'RHF',
                  'e_convergence': 1e-10,
                  'd_convergence': 1e-10,
                  'DIIS': True,
                  'freeze_core': False,
                  'F_el': [0.0, 0.0, 0.0],
                  'F_mag': [0.0, 0.0, 0.0],
                  'max_iterations': 120}

    # Setting RHF reference Hessian from CFOUR HF/STO-3G optimized geometry.
    hess_ref = np.array([
     [  0.0000002355,        0.0000000000,        0.0000000000],
     [ -0.0000001178,        0.0000000000,        0.0000000000],
     [ -0.0000001178,        0.0000000000,        0.0000000000],
     [  0.0000000000,        0.8039499964,        0.0000000000],
     [  0.0000000000,       -0.4019749982,       -0.3371363249],
     [  0.0000000000,       -0.4019749982,        0.3371363249],
     [  0.0000000000,        0.0000000000,        0.6348993605],
     [  0.0000000000,       -0.2163116072,       -0.3174496803],
     [  0.0000000000,        0.2163116072,       -0.3174496803],
     [ -0.0000001178,        0.0000000000,        0.0000000000],
     [  0.0000001262,        0.0000000000,        0.0000000000],
     [ -0.0000000084,        0.0000000000,        0.0000000000],
     [  0.0000000000,       -0.4019749982,       -0.2163116072],
     [  0.0000000000,        0.4389111622,        0.2767239660],
     [  0.0000000000,       -0.0369361640,       -0.0604123588],
     [  0.0000000000,       -0.3371363249,       -0.3174496803],
     [  0.0000000000,        0.2767239660,        0.3001030221],
     [  0.0000000000,        0.0604123588,        0.0173466582],
     [ -0.0000001178,        0.0000000000,        0.0000000000],
     [ -0.0000000084,        0.0000000000,        0.0000000000],
     [  0.0000001262,        0.0000000000,        0.0000000000],
     [  0.0000000000,       -0.4019749982,        0.2163116072],
     [  0.0000000000,       -0.0369361640,        0.0604123588],
     [  0.0000000000,        0.4389111622,       -0.2767239660],
     [  0.0000000000,        0.3371363249,       -0.3174496803],
     [  0.0000000000,       -0.0604123588,        0.0173466582],
     [  0.0000000000,       -0.2767239660,        0.3001030221]
    ])  
    
    # Compute energy.
    E_list, T_list, C, basis = apyib.energy.energy(parameters)

    # Compute finite difference Hessian using apyib.
    analytic_derivative = apyib.analytic.analytic_derivative(parameters)
    hessian = analytic_derivative.compute_RHF_Hessian()

    assert(np.max(np.abs(hessian-hess_ref.reshape(9,9))) < 1e-10)

@pytest.mark.skip(reason="Too slow.")
def test_rhf_analytic_hessian2():
    # Set parameters for the calculation.
    parameters = {'geom': moldict["(R)-methylthiirane"],
                  'basis': 'STO-3G',
                  'method': 'RHF',
                  'e_convergence': 1e-10,
                  'd_convergence': 1e-10,
                  'DIIS': True,
                  'freeze_core': False,
                  'F_el': [0.0, 0.0, 0.0],
                  'F_mag': [0.0, 0.0, 0.0],
                  'max_iterations': 120}

    # Setting RHF reference Hessian from CFOUR HF/STO-3G optimized geometry.
    hess_ref = np.array(
    [[ 0.454711863205726,  0.210549733639032,  0.131809347784109],
     [-0.182898325443659, -0.116044214166928,  0.069994857838885],
     [-0.012732860495841, -0.030883105340015,  0.012572297875572],
     [ 0.002219829077269,  0.000687423245762,  0.001424379909738],
     [-0.037726205978877,  0.048791341162313, -0.017572463215781],
     [-0.087787270979013,  0.016243876605718, -0.0919034849826  ],
     [-0.132026308183384, -0.132214304291006, -0.105274152018058],
     [-0.003011095995344,  0.001391152796263,  0.000331586989099],
     [-0.002876196425219,  0.000394715590487, -0.002329971551496],
     [ 0.002126571217336,  0.001083380758726,  0.00094760137053 ],
     [ 0.210549733639032,  0.775653856153218, -0.07395740239471 ],
     [-0.165321026470175, -0.206003768972439,  0.106059471067009],
     [ 0.000338049916113, -0.012137895393866,  0.004996955051526],
     [ 0.000807717971153,  0.00056863475534 ,  0.00064376481191 ],
     [ 0.066416232947757, -0.210690602634251,  0.012404866485613],
     [ 0.013531606714458, -0.101316464536117,  0.10494104914023 ],
     [-0.126220753382428, -0.25205275955555 , -0.149550956748222],
     [ 0.001387507107096,  0.004168760091674, -0.00544564811725 ],
     [-0.002676629535786,  0.00039691644895 , -0.00069827202865 ],
     [ 0.001187561093128,  0.001413323641936,  0.000606172732534],
     [ 0.131809347784109, -0.07395740239471 ,  0.808591278193071],
     [ 0.082238977110364,  0.083291634259782, -0.157563643325064],
     [-0.000741396427507, -0.023396328987089,  0.010680898963955],
     [-0.000312268901343, -0.000912870576301,  0.001253464060308],
     [-0.020821635968897,  0.018482036323965, -0.043225896377832],
     [-0.102263169117051,  0.110276667045735, -0.401986923296287],
     [-0.096651399745154, -0.154024267938265, -0.208493999608684],
     [ 0.011170272717783,  0.041020559644083, -0.007037159747231],
     [-0.00572821802767 , -0.0011419012256  , -0.002553406419927],
     [ 0.001299490575358,  0.000361873848392,  0.000335387558686],
     [-0.182898325443659, -0.165321026470175,  0.082238977110364],
     [ 0.728285025556925,  0.203127234466658, -0.048010384575798],
     [-0.2709947554624  , -0.067741715328661, -0.089649516658918],
     [ 0.006114232795085,  0.003263561914786,  0.003780860272186],
     [-0.175349230394962,  0.049734015629318,  0.05088690856796 ],
     [ 0.011495570399602,  0.005417630518767, -0.007257171584186],
     [-0.011052767428351,  0.000649493936718,  0.011805280176985],
     [-0.066012026538372, -0.012867861461005,  0.020611082091603],
     [-0.01164714558412 , -0.001414569713979, -0.006931462231994],
     [-0.027940577898633, -0.014846763492233, -0.017474573168072],
     [-0.116044214166928, -0.206003768972439,  0.083291634259782],
     [ 0.203127234466658,  0.42725711182627 , -0.011955723649638],
     [-0.075889501283159, -0.121016042855832, -0.03288652210781 ],
     [-0.001968752065448, -0.001233343474391,  0.0001895699645  ],
     [ 0.034346300332797, -0.028805282837932, -0.021420665020557],
     [-0.005163671390676, -0.005709482982087,  0.001678890315199],
     [-0.016761796546773, -0.007317111210998,  0.015657170847585],
     [-0.008574359554584, -0.064052096088351, -0.025115133013854],
     [-0.034240480373457, -0.005146736046755, -0.022295583171596],
     [ 0.021169240581752,  0.012026752643214,  0.01285636157636 ],
     [ 0.069994857838885,  0.106059471067009, -0.157563643325064],
     [-0.048010384575798, -0.011955723649638,  0.848006955976467],
     [-0.097447860169363, -0.026156345900498, -0.173839331335473],
     [-0.042508406952526, -0.013788538470171, -0.013436511805951],
     [ 0.058280208346691, -0.029774696556464, -0.067342335719758],
     [ 0.036125936991099,  0.009062691381385, -0.010807363959992],
     [-0.024049176289327, -0.004972990497981,  0.015140673439362],
     [ 0.024524664168757, -0.035584146943254, -0.454926971999821],
     [ 0.016697145725079,  0.004058628866807,  0.010146849164101],
     [ 0.006393014916635,  0.00305165070278 ,  0.004621679566299],
     [-0.012732860495841,  0.000338049916113, -0.000741396427507],
     [-0.2709947554624  , -0.075889501283159, -0.097447860169363],
     [ 0.760084914861526, -0.007972921876751, -0.036073551495956],
     [-0.08511825498094 ,  0.003391748206677,  0.050527536645995],
     [-0.026269990281192, -0.006429198073988, -0.00538782965051 ],
     [ 0.00204763545155 ,  0.000250241621037, -0.001064295555039],
     [ 0.000273763205062,  0.001461182229277, -0.000714114278061],
     [ 0.00652648965073 ,  0.002095807028976,  0.005506814264325],
     [-0.102320948337418, -0.084718712006305,  0.034558170990242],
     [-0.271495993610967,  0.16747330423812 ,  0.050836525675873],
     [-0.030883105340015, -0.012137895393866, -0.023396328987089],
     [-0.067741715328661, -0.121016042855832, -0.026156345900498],
     [-0.007972921876751,  0.811353661377633, -0.011693670761145],
     [ 0.003841810877011, -0.083091209465947, -0.020109367840841],
     [ 0.022955756840948,  0.004657459473603,  0.008395739397996],
     [ 0.002195229961718,  0.001739789002864, -0.001954789478012],
     [-0.005116051782106, -0.000181917301156,  0.003319954157699],
     [-0.002596875306933,  0.000478629578629,  0.001364040446587],
     [-0.086048092439971, -0.376159032359679,  0.110975239395268],
     [ 0.171365964394758, -0.225643442055582, -0.040744470429965],
     [ 0.012572297875572,  0.004996955051526,  0.010680898963955],
     [-0.089649516658918, -0.03288652210781 , -0.173839331335473],
     [-0.036073551495956, -0.011693670761145,  0.82267030632538 ],
     [ 0.051627230718384, -0.020209547926319, -0.436362599570401],
     [ 0.008205138585691,  0.001137532495417,  0.003418036121775],
     [-0.000027216939103,  0.000583270877354,  0.001533129649486],
     [ 0.002382936185533,  0.000209486071133, -0.002014347448619],
     [-0.037460634493847, -0.012489081786799, -0.008132679946099],
     [ 0.035430247700543,  0.112411816320679, -0.123754806243647],
     [ 0.052993068522102, -0.042060238234035, -0.094198606517062],
     [ 0.002219829077269,  0.000807717971153, -0.000312268901343],
     [ 0.006114232795085, -0.001968752065448, -0.042508406952526],
     [-0.08511825498094 ,  0.003841810877011,  0.051627230718384],
     [ 0.082881209150689, -0.00095403771128 , -0.050738736645784],
     [ 0.001827987833469,  0.000469031758973,  0.000078191067977],
     [-0.000177789656617, -0.000089653422632,  0.000203771137497],
     [ 0.000173543082831,  0.000058102724762,  0.000126309411911],
     [-0.006190825229551, -0.002779263074485, -0.001590791963422],
     [-0.00132423545014 ,  0.003502841301319,  0.010044399783238],
     [-0.000405696622097, -0.002887798359373,  0.033070302344067],
     [ 0.000687423245762,  0.00056863475534 , -0.000912870576301],
     [ 0.003263561914786, -0.001233343474391, -0.013788538470171],
     [ 0.003391748206677, -0.083091209465947, -0.020209547926319],
     [-0.00095403771128 ,  0.073422368594499,  0.022606982483722],
     [ 0.000099005579838,  0.000305275955333,  0.000711896643443],
     [-0.000115044900203, -0.000155105595091, -0.000034314404278],
     [ 0.000146198269012, -0.000026667523907,  0.00009843288312 ],
     [-0.002507080647352,  0.000231074635943, -0.000576704945854],
     [-0.004669664669577,  0.008620706598702,  0.042186892035212],
     [ 0.000657890712338,  0.00135826551952 , -0.030082227722574],
     [ 0.001424379909738,  0.00064376481191 ,  0.001253464060308],
     [ 0.003780860272186,  0.0001895699645  , -0.013436511805951],
     [ 0.050527536645995, -0.020109367840841, -0.436362599570401],
     [-0.050738736645784,  0.022606982483722,  0.454130040190953],
     [ 0.000972312640142,  0.000403307023915,  0.000637191429551],
     [-0.000189935688092, -0.000101414387031,  0.000230826299908],
     [ 0.000256371563995,  0.000026395304412,  0.000092307797851],
     [-0.001756625050558, -0.000702285492851,  0.00047868947721 ],
     [-0.000233623387815, -0.007027753270043, -0.006772706615007],
     [-0.004042540259807,  0.004070801402307, -0.000250701264419],
     [-0.037726205978877,  0.066416232947757, -0.020821635968897],
     [-0.175349230394962,  0.034346300332797,  0.058280208346691],
     [-0.026269990281192,  0.022955756840948,  0.008205138585691],
     [ 0.001827987833469,  0.000099005579838,  0.000972312640142],
     [ 0.247077132170354, -0.125507763306138, -0.046927901418295],
     [-0.004529964384828,  0.005585241167717,  0.005822327701072],
     [ 0.006900994377098, -0.007930867000694, -0.001269490653788],
     [-0.011545235840596,  0.007490822015476, -0.001997465399105],
     [ 0.002421291277608,  0.000205039865642,  0.000532139822692],
     [-0.002806778756205, -0.003659768442781, -0.002795633656118],
     [ 0.048791341162313, -0.210690602634251,  0.018482036323965],
     [ 0.049734015629318, -0.028805282837932, -0.029774696556464],
     [-0.006429198073988,  0.004657459473603,  0.001137532495417],
     [ 0.000469031758973,  0.000305275955333,  0.000403307023915],
     [-0.125507763306138,  0.268491140003223,  0.008870249677659],
     [ 0.008764087859846, -0.013664376141   , -0.006770352326897],
     [ 0.02177945506731 , -0.01797048331338 ,  0.004084613884724],
     [ 0.00350806713881 , -0.002774839587596,  0.0035731730244  ],
     [ 0.000351496232538,  0.000524186899265,  0.000480330882329],
     [-0.001460533468411, -0.000072477757663, -0.000486194429068],
     [-0.017572463215781,  0.012404866485613, -0.043225896377832],
     [ 0.05088690856796 , -0.021420665020557, -0.067342335719758],
     [-0.00538782965051 ,  0.008395739397996,  0.003418036121775],
     [ 0.000078191067977,  0.000711896643443,  0.000637191429551],
     [-0.046927901418295,  0.008870249677659,  0.094787597114891],
     [-0.016377876831424,  0.020450658264543,  0.008632610881084],
     [ 0.012536907099417, -0.008116959243414,  0.001384115190269],
     [ 0.024870431717173, -0.0205798907213  ,  0.001656191777767],
     [ 0.000409622224442, -0.000027755945865,  0.000309198723694],
     [-0.00251598956087 , -0.000688139538142, -0.00025670917296 ],
     [-0.087787270979013,  0.013531606714458, -0.102263169117051],
     [ 0.011495570399602, -0.005163671390676,  0.036125936991099],
     [ 0.00204763545155 ,  0.002195229961718, -0.000027216939103],
     [-0.000177789656617, -0.000115044900203, -0.000189935688092],
     [-0.004529964384828,  0.008764087859846, -0.016377876831424],
     [ 0.081344390195758, -0.021398094430353,  0.093752542224025],
     [-0.001093068318088,  0.008284565578432, -0.01187880854133 ],
     [-0.001437888499847, -0.006242432147419,  0.000854341516334],
     [ 0.000178276419447,  0.000096556016007, -0.000025910624822],
     [-0.000039890627953,  0.000047196738188,  0.000030097010363],
     [ 0.016243876605718, -0.101316464536117,  0.110276667045735],
     [ 0.005417630518767, -0.005709482982087,  0.009062691381385],
     [ 0.000250241621037,  0.001739789002864,  0.000583270877354],
     [-0.000089653422632, -0.000155105595091, -0.000101414387031],
     [ 0.005585241167717, -0.013664376141   ,  0.020450658264543],
     [-0.021398094430353,  0.105690791763773, -0.11200804662411 ],
     [-0.006467984808124,  0.014590346040156, -0.027491267200677],
     [ 0.000564143018598, -0.001120470798003, -0.000562268262601],
     [ 0.000221172392842,  0.000083355928479, -0.000031341109764],
     [-0.000326572663569, -0.000138382682962, -0.000178949984834],
     [-0.0919034849826  ,  0.10494104914023 , -0.401986923296287],
     [-0.007257171584186,  0.001678890315199, -0.010807363959992],
     [-0.001064295555039, -0.001954789478012,  0.001533129649486],
     [ 0.000203771137497, -0.000034314404278,  0.000230826299908],
     [ 0.005822327701072, -0.006770352326897,  0.008632610881084],
     [ 0.093752542224025, -0.11200804662411 ,  0.41054715102033 ],
     [ 0.000942290637658,  0.012271365252162, -0.00823154992344 ],
     [-0.000138770105756,  0.002021473346105,  0.000168942728167],
     [-0.000294314885766, -0.000183440197346, -0.000083761074771],
     [-0.000062894586904,  0.000038164976947, -0.000003062324489],
     [-0.132026308183384, -0.126220753382428, -0.096651399745154],
     [-0.011052767428351, -0.016761796546773, -0.024049176289327],
     [ 0.000273763205062, -0.005116051782106,  0.002382936185533],
     [ 0.000173543082831,  0.000146198269012,  0.000256371563995],
     [ 0.006900994377098,  0.02177945506731 ,  0.012536907099417],
     [-0.001093068318088, -0.006467984808124,  0.000942290637658],
     [ 0.13660205688892 ,  0.129946247189212,  0.106143031395121],
     [ 0.001326672832712,  0.002709129601484, -0.00115488229246 ],
     [-0.001450210379746, -0.000210589002247, -0.000569620957911],
     [ 0.000345323922941,  0.000196145394662,  0.000163542403129],
     [-0.132214304291006, -0.25205275955555 , -0.154024267938265],
     [ 0.000649493936718, -0.007317111210998, -0.004972990497981],
     [ 0.001461182229277, -0.000181917301156,  0.000209486071133],
     [ 0.000058102724762, -0.000026667523907,  0.000026395304412],
     [-0.007930867000694, -0.01797048331338 , -0.008116959243414],
     [ 0.008284565578432,  0.014590346040156,  0.012271365252162],
     [ 0.129946247189212,  0.261153752540007,  0.154973136261033],
     [-0.000104699494059,  0.001647969490995, -0.000340747731739],
     [-0.000149805256453,  0.00011106691442 , -0.000048803881176],
     [ 0.000000084383812,  0.000045803919434,  0.000023386403835],
     [-0.105274152018058, -0.149550956748222, -0.208493999608684],
     [ 0.011805280176985,  0.015657170847585,  0.015140673439362],
     [-0.000714114278061,  0.003319954157699, -0.002014347448619],
     [ 0.000126309411911,  0.00009843288312 ,  0.000092307797851],
     [-0.001269490653788,  0.004084613884724,  0.001384115190269],
     [-0.01187880854133 , -0.027491267200677, -0.00823154992344 ],
     [ 0.106143031395121,  0.154973136261033,  0.199831391091158],
     [ 0.000142115404589, -0.001173827065054,  0.00160399594964 ],
     [ 0.001007275703464,  0.000134354440584,  0.000708988621786],
     [-0.000087446600834, -0.000051611460792, -0.000021575109317],
     [-0.003011095995344,  0.001387507107096,  0.011170272717783],
     [-0.066012026538372, -0.008574359554584,  0.024524664168757],
     [ 0.00652648965073 , -0.002596875306933, -0.037460634493847],
     [-0.006190825229551, -0.002507080647352, -0.001756625050558],
     [-0.011545235840596,  0.00350806713881 ,  0.024870431717173],
     [-0.001437888499847,  0.000564143018598, -0.000138770105756],
     [ 0.001326672832712, -0.000104699494059,  0.000142115404589],
     [ 0.077011450490909,  0.007267176124429, -0.023337586655919],
     [ 0.001252675817771,  0.000681293672801,  0.000928902568995],
     [ 0.002079783311566,  0.000374827941194,  0.001057229728782],
     [ 0.001391152796263,  0.004168760091674,  0.041020559644083],
     [-0.012867861461005, -0.064052096088351, -0.035584146943254],
     [ 0.002095807028976,  0.000478629578629, -0.012489081786799],
     [-0.002779263074485,  0.000231074635943, -0.000702285492851],
     [ 0.007490822015476, -0.002774839587596, -0.0205798907213  ],
     [-0.006242432147419, -0.001120470798003,  0.002021473346105],
     [ 0.002709129601484,  0.001647969490995, -0.001173827065054],
     [ 0.007267176124429,  0.060508866120147,  0.026858981125964],
     [ 0.00115475559846 ,  0.000673760352811,  0.000275637837259],
     [-0.000219286482177,  0.000238346203749,  0.000352580055847],
     [ 0.000331586989099, -0.00544564811725 , -0.007037159747231],
     [ 0.020611082091603, -0.025115133013854, -0.454926971999821],
     [ 0.005506814264325,  0.001364040446587, -0.008132679946099],
     [-0.001590791963422, -0.000576704945854,  0.00047868947721 ],
     [-0.001997465399105,  0.0035731730244  ,  0.001656191777767],
     [ 0.000854341516334, -0.000562268262601,  0.000168942728167],
     [-0.00115488229246 , -0.000340747731739,  0.00160399594964 ],
     [-0.023337586655919,  0.026858981125964,  0.464765551158884],
     [ 0.000443406956481,  0.000064710412157,  0.000815171450813],
     [ 0.000333494493063,  0.00017959706219 ,  0.00060826915068 ],
     [-0.002876196425219, -0.002676629535786, -0.00572821802767 ],
     [-0.01164714558412 , -0.034240480373457,  0.016697145725079],
     [-0.102320948337418, -0.086048092439971,  0.035430247700543],
     [-0.00132423545014 , -0.004669664669577, -0.000233623387815],
     [ 0.002421291277608,  0.000351496232538,  0.000409622224442],
     [ 0.000178276419447,  0.000221172392842, -0.000294314885766],
     [-0.001450210379746, -0.000149805256453,  0.001007275703464],
     [ 0.001252675817771,  0.00115475559846 ,  0.000443406956481],
     [ 0.102881013846806,  0.094151245807897, -0.033462434500285],
     [ 0.012885478815009,  0.031906002243507, -0.014269107508472],
     [ 0.000394715590487,  0.00039691644895 , -0.0011419012256  ],
     [-0.001414569713979, -0.005146736046755,  0.004058628866807],
     [-0.084718712006305, -0.376159032359679,  0.112411816320679],
     [ 0.003502841301319,  0.008620706598702, -0.007027753270043],
     [ 0.000205039865642,  0.000524186899265, -0.000027755945865],
     [ 0.000096556016007,  0.000083355928479, -0.000183440197346],
     [-0.000210589002247,  0.00011106691442 ,  0.000134354440584],
     [ 0.000681293672801,  0.000673760352811,  0.000064710412157],
     [ 0.094151245807897,  0.388270731660793, -0.119357695418281],
     [-0.012687821531623, -0.017374956396968,  0.011069036016909],
     [-0.002329971551496, -0.00069827202865 , -0.002553406419927],
     [-0.006931462231994, -0.022295583171596,  0.010146849164101],
     [ 0.034558170990242,  0.110975239395268, -0.123754806243647],
     [ 0.010044399783238,  0.042186892035212, -0.006772706615007],
     [ 0.000532139822692,  0.000480330882329,  0.000309198723694],
     [-0.000025910624822, -0.000031341109764, -0.000083761074771],
     [-0.000569620957911, -0.000048803881176,  0.000708988621786],
     [ 0.000928902568995,  0.000275637837259,  0.000815171450813],
     [-0.033462434500285, -0.119357695418281,  0.117359020382365],
     [-0.00274421329866 , -0.011486404540601,  0.003825452010603],
     [ 0.002126571217336,  0.001187561093128,  0.001299490575358],
     [-0.027940577898633,  0.021169240581752,  0.006393014916635],
     [-0.271495993610967,  0.171365964394758,  0.052993068522102],
     [-0.000405696622097,  0.000657890712338, -0.004042540259807],
     [-0.002806778756205, -0.001460533468411, -0.00251598956087 ],
     [-0.000039890627953, -0.000326572663569, -0.000062894586904],
     [ 0.000345323922941,  0.000000084383812, -0.000087446600834],
     [ 0.002079783311566, -0.000219286482177,  0.000333494493063],
     [ 0.012885478815009, -0.012687821531623, -0.00274421329866 ],
     [ 0.285251780248993, -0.179686527020011, -0.051565984200084],
     [ 0.001083380758726,  0.001413323641936,  0.000361873848392],
     [-0.014846763492233,  0.012026752643214,  0.00305165070278 ],
     [ 0.16747330423812 , -0.225643442055582, -0.042060238234035],
     [-0.002887798359373,  0.00135826551952 ,  0.004070801402307],
     [-0.003659768442781, -0.000072477757663, -0.000688139538142],
     [ 0.000047196738188, -0.000138382682962,  0.000038164976947],
     [ 0.000196145394662,  0.000045803919434, -0.000051611460792],
     [ 0.000374827941194,  0.000238346203749,  0.00017959706219 ],
     [ 0.031906002243507, -0.017374956396968, -0.011486404540601],
     [-0.179686527020011,  0.228146766965337,  0.046584305780955],
     [ 0.00094760137053 ,  0.000606172732534,  0.000335387558686],
     [-0.017474573168072,  0.01285636157636 ,  0.004621679566299],
     [ 0.050836525675873, -0.040744470429965, -0.094198606517062],
     [ 0.033070302344067, -0.030082227722574, -0.000250701264419],
     [-0.002795633656118, -0.000486194429068, -0.00025670917296 ],
     [ 0.000030097010363, -0.000178949984834, -0.000003062324489],
     [ 0.000163542403129,  0.000023386403835, -0.000021575109317],
     [ 0.001057229728782,  0.000352580055847,  0.00060826915068 ],
     [-0.014269107508472,  0.011069036016909,  0.003825452010603],
     [-0.051565984200084,  0.046584305780955,  0.085339866101989]])
    # Compute energy.
    E_list, T_list, C, basis = apyib.energy.energy(parameters)

    # Compute finite difference Hessian using apyib.
    analytic_derivative = apyib.analytic.analytic_derivative(parameters)
    hessian = analytic_derivative.compute_RHF_Hessian()

    assert(np.max(np.abs(hessian-hess_ref.reshape(30,30))) < 1e-10)
